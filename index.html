<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æœã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰ï¼ˆæœ€å¤§1000ï¼‰</title>
<style>
  body { font-family: system-ui, -apple-system, BlinkMacSystemFont; padding: 16px; }
  h1 { text-align: center; }
  .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 12px; }
  select, input, button { font-size: 14px; padding: 6px 8px; }

  .info { text-align: center; margin-bottom: 8px; font-size: 14px; }

  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸ */
  .table-wrap {
    max-height: 420px; /* 6è¡Œåˆ†ãã‚‰ã„ */
    overflow-y: auto;
    margin: 0 auto;
    width: fit-content;
    border: 1px solid #ccc;
  }

  table { border-collapse: collapse; }
  td { width: 48px; height: 48px; border: 1px solid #999; text-align: center; font-size: 22px; }

  /* è¡Œç•ªå·ï¼ˆè¡¨ã®å¤–ãƒ»å³å´ï¼‰ */
  .row-num {
    width: 40px;
    text-align: left;
    padding-left: 6px;
    font-size: 12px;
    color: #555;
    border: none;
  }

  .settings { max-width: 420px; margin: 16px auto; border-top: 2px solid #ccc; padding-top: 12px; }
  .row { display: flex; justify-content: space-between; margin-bottom: 8px; }
</style>
</head>
<body>

<h1>ğŸ æœã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h1>

<div class="info">5åˆ— Ã— 6è¡Œè¡¨ç¤ºï¼ˆæœ€å¤§1000ã‚¹ã‚¿ãƒ³ãƒ—ï¼‰ï¼ ğŸ“ç èœ ğŸ”«ç…Œ ğŸª²ç‰çœ</div>

<div class="controls">
  <label>æ—¥ã«ã¡ <input type="date" id="date"></label>
  <label>
    ãªã¾ãˆ
    <select id="kid">
      <option value="">é¸æŠ</option>
      <option value="ç èœ">ç èœ</option>
      <option value="ç…Œ">ç…Œ</option>
      <option value="ç‰çœ">ç‰çœ</option>
    </select>
  </label>
  <button onclick="addStamp()">ã‚¹ã‚¿ãƒ³ãƒ—</button>
</div>

<div class="table-wrap">
  <table>
    <tbody id="sheet"></tbody>
  </table>
</div>

<div class="settings">
  <h2>âš™ ç›®æ¨™æ™‚é–“ï¼ˆå€‹äººåˆ¥ï¼‰</h2>
  <div class="row">ç èœ <input type="time" id="limit-ç èœ" value="07:30"></div>
  <div class="row">ç…Œ <input type="time" id="limit-ç…Œ" value="07:30"></div>
  <div class="row">ç‰çœ <input type="time" id="limit-ç‰çœ" value="07:30"></div>
</div>

<script>
const COLS = 5;
const VISIBLE_ROWS = 6; // è¡¨ç¤ºã¯6è¡Œ
const MAX = 1000;

const STAMP = {
  "ç èœ": "ğŸ“",
  "ç…Œ": "ğŸ”«",
  "ç‰çœ": "ğŸª²"
};

function today() {
  return new Date().toISOString().slice(0,10);
}

function loadStamps() {
  return JSON.parse(localStorage.getItem("stamps1000") || "[]");
}

function saveStamps(data) {
  localStorage.setItem("stamps1000", JSON.stringify(data));
}

function addStamp() {
  const date = document.getElementById("date").value;
  const kid = document.getElementById("kid").value;
  if (!date || !kid) {
    alert("æ—¥ã«ã¡ã¨ãªã¾ãˆã‚’é¸ã‚“ã§ãã ã•ã„");
    return;
  }

  const stamps = loadStamps();
  if (stamps.length >= MAX) {
    alert("ã‚¹ã‚¿ãƒ³ãƒ—ã¯1000å€‹ã¾ã§ã§ã™");
    return;
  }

  if (stamps.some(s => s.date === date && s.kid === kid)) {
    alert("ã“ã®æ—¥ã¯ã™ã§ã«ã‚¹ã‚¿ãƒ³ãƒ—ãŒã‚ã‚Šã¾ã™");
    return;
  }

  const limit = document.getElementById(`limit-${kid}`).value;
  const now = new Date().toTimeString().slice(0,5);
  if (date === today() && now > limit) {
    alert("ç›®æ¨™æ™‚é–“ã‚’éãã¦ã„ã¾ã™");
    return;
  }

  stamps.push({ date, kid });
  saveStamps(stamps);
  render();
}

function render() {
  const stamps = loadStamps();
  const tbody = document.getElementById("sheet");
  tbody.innerHTML = "";

  const totalRows = Math.ceil(MAX / COLS);

  for (let r = 0; r < totalRows; r++) {
    const tr = document.createElement("tr");

    for (let c = 0; c < COLS; c++) {
      const idx = r * COLS + c;
      const td = document.createElement("td");
      if (idx < stamps.length) {
        const s = stamps[idx];
        td.textContent = STAMP[s.kid] || "â­";
        td.title = `${idx + 1}å€‹ç›®ï¼š${s.date} ${s.kid}`;
      }
      tr.appendChild(td);
    }

    // è¡Œç•ªå·ï¼ˆ5å€‹ã”ã¨ï¼‰
    const num = document.createElement("td");
    num.className = "row-num";
    num.textContent = (r + 1) * COLS;
    tr.appendChild(num);

    tbody.appendChild(tr);
  }
}

// åˆæœŸåŒ–
document.getElementById("date").value = today();
render();
</script>

</body>
</html>