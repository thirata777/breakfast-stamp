<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<!-- iPhoneå°‚ç”¨ã‚¢ã‚¤ã‚³ãƒ³ -->
<link rel="apple-touch-icon" href="stamp-icon-192.png">

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æœã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰ï¼ˆæœ€å¤§1000ï¼‰</title>
<style>
  body { font-family: system-ui, -apple-system, BlinkMacSystemFont; padding: 16px; }
  h1 { 
  text-align: center; 
  font-size: 20px; /* å…ƒã‚ˆã‚Šå°‘ã—å°ã•ã‚ã« */
}

  .controls { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 12px; }
  select, input, button { font-size: 14px; padding: 6px 8px; }

  .info { text-align: center; margin-bottom: 8px; font-size: 14px; }

  /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é ˜åŸŸ */
  .table-wrap {
    max-height: 420px; /* 6è¡Œåˆ†ãã‚‰ã„ */
    overflow-y: auto;
    margin: 0 auto;
    width: fit-content;
    border: 1px solid #ccc;
  }

  table { border-collapse: collapse; }
  td { width: 48px; height: 48px; border: 1px solid #999; text-align: center; font-size: 22px; }

  /* è¡Œç•ªå·ï¼ˆè¡¨ã®å¤–ãƒ»å³å´ï¼‰ */
  .row-num {
    width: 40px;
    text-align: left;
    padding-left: 6px;
    font-size: 12px;
    color: #555;
    border: none;
  }

  .settings { max-width: 420px; margin: 16px auto; border-top: 2px solid #ccc; padding-top: 12px; }
  .row { display: flex; justify-content: space-between; margin-bottom: 8px; }
</style>
</head>
<body>

<h1>ğŸ æœã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h1>



<div class="controls">
  <div id="totals" style="width:100%; text-align:center; font-size:14px; margin-bottom:6px;"></div>
  <label>æ—¥ã«ã¡ <input type="date" id="date"></label>
  <label>
    ãªã¾ãˆ
    <select id="kid">
      <option value="">é¸æŠ</option>
      <option value="ç èœ">ç èœ</option>
      <option value="ç…Œ">ç…Œ</option>
      <option value="ç‰çœ">ç‰çœ</option>
    </select>
  </label>
  <button onclick="addStamp()">ã‚¹ã‚¿ãƒ³ãƒ—</button>
  <button onclick="removeOne()">1å€‹å‰Šé™¤</button>
  <button onclick="removeAll()">å…¨å‰Šé™¤</button>
</div>

<div class="table-wrap">
  <table>
    <tbody id="sheet"></tbody>
  </table>
</div>

<div class="settings">
  <h2>ğŸ æ™¯å“äº¤æ›</h2>
  <table style="width:100%; border-collapse:collapse; font-size:8px;">
    <thead>
      <tr><th style="text-align:left;">å¿…è¦æ•°</th><th style="text-align:left;">æ™¯å“</th><th></th></tr>
    </thead>
    <tbody id="rewards"></tbody>
  </table>
</div>

<div class="settings">
  <h2>âš™ ç›®æ¨™æ™‚é–“ï¼ˆå€‹äººåˆ¥ï¼‰</h2>
  <div class="row">ç èœ <input type="time" id="limit-ç èœ" value="07:30"></div>
  <div class="row">ç…Œ <input type="time" id="limit-ç…Œ" value="07:30"></div>
  <div class="row">ç‰çœ <input type="time" id="limit-ç‰çœ" value="07:30"></div>
</div>

<script>
const COLS = 5;
const VISIBLE_ROWS = 6; // è¡¨ç¤ºã¯6è¡Œ
const MAX = 1000;

const STAMP = {
  "ç èœ": "ğŸ“",
  "ç…Œ": "ğŸ”«",
  "ç‰çœ": "ğŸª²"
};

const REWARDS = [
  { need: 10, label: "ã˜ã‚ƒãŒã‚Šã“ 1å€‹" },
  { need: 20, label: "ã˜ã‚ƒãŒã‚Šã“ 3å€‹" },
  { need: 30, label: "ãƒãƒƒã‚¯å¥½ããªã® 3å€‹" },
  { need: 50, label: "ã‚¹ãƒ†ãƒ¼ã‚­ğŸ¥©(ãƒ’ãƒ¬è‚‰) 1æš" },
  { need: 100, label: "ã‹ã«ğŸ¦€" },
  { need: 200, label: "æ‰ä¹ƒäº•ãƒ›ãƒ†ãƒ«ğŸ¨" },
  { need: 500, label: "ã‚¢ã‚«ãƒãƒ©ã‚¤ãƒ¢ãƒªğŸ¦" },
  { need: 800, label: "ãƒ’ãƒ§ã‚¦ãƒ¢ãƒ³ãƒˆã‚«ã‚²ãƒ¢ãƒ‰ã‚­ğŸ¸" },
  { need: 1000, label: "ãƒ•ãƒˆã‚¢ã‚´ãƒ’ã‚²ãƒˆã‚«ã‚²ğŸŠ" }
];

function today() {
  return new Date().toISOString().slice(0,10);
}

function loadStamps() {
  return JSON.parse(localStorage.getItem("stamps1000") || "[]");
}

function saveStamps(data) {
  localStorage.setItem("stamps1000", JSON.stringify(data));
}

function addStamp() {
  const date = document.getElementById("date").value;
  const kid = document.getElementById("kid").value;
  if (!date || !kid) {
    alert("æ—¥ã«ã¡ã¨ãªã¾ãˆã‚’é¸ã‚“ã§ãã ã•ã„");
    return;
  }

  const stamps = loadStamps();
  if (stamps.length >= MAX) {
    alert("ã‚¹ã‚¿ãƒ³ãƒ—ã¯1000å€‹ã¾ã§ã§ã™");
    return;
  }

  if (stamps.some(s => s.date === date && s.kid === kid)) {
    alert("ã“ã®æ—¥ã¯ã™ã§ã«ã‚¹ã‚¿ãƒ³ãƒ—ãŒã‚ã‚Šã¾ã™");
    return;
  }

  const limit = document.getElementById(`limit-${kid}`).value;
  const now = new Date().toTimeString().slice(0,5);
  if (date === today() && now > limit) {
    alert("ç›®æ¨™æ™‚é–“ã‚’éãã¦ã„ã¾ã™");
    return;
  }

  stamps.push({ date, kid });
  saveStamps(stamps);
  render();
}

function renderRewards(total) {
  const tbody = document.getElementById("rewards");
  tbody.innerHTML = "";

  REWARDS.forEach(r => {
    const tr = document.createElement("tr");

    const tdNeed = document.createElement("td");
    tdNeed.textContent = r.need;

    const tdLabel = document.createElement("td");
    tdLabel.textContent = r.label;

    const tdBtn = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "äº¤æ›";
    btn.disabled = total < r.need;
    btn.onclick = () => exchange(r.need, r.label);
    tdBtn.appendChild(btn);

    tr.appendChild(tdNeed);
    tr.appendChild(tdLabel);
    tr.appendChild(tdBtn);
    tbody.appendChild(tr);
  });
}

function exchange(need, label) {
  if (!confirm(`${need}å€‹ä½¿ã£ã¦ã€Œ${label}ã€ã¨äº¤æ›ã—ã¾ã™ã‹ï¼Ÿ`)) return;
  const stamps = loadStamps();
  stamps.splice(0, need);
  saveStamps(stamps);
  playAnimation(label);
  render();
}

function playAnimation(label) {
  const anim = document.createElement("div");
  anim.textContent = `ğŸ‰ ${label} GET!! ğŸ‰`;
  anim.style.position = "fixed";
  anim.style.top = "50%";
  anim.style.left = "50%";
  anim.style.transform = "translate(-50%, -50%) scale(0.5)";
  anim.style.fontSize = "32px";
  anim.style.background = "rgba(255,255,255,0.95)";
  anim.style.padding = "20px 30px";
  anim.style.borderRadius = "16px";
  anim.style.boxShadow = "0 8px 20px rgba(0,0,0,0.3)";
  anim.style.transition = "all 0.6s ease";
  anim.style.zIndex = "9999";

  document.body.appendChild(anim);

  requestAnimationFrame(() => {
    anim.style.transform = "translate(-50%, -50%) scale(1.2)";
  });

  setTimeout(() => {
    anim.style.opacity = "0";
    anim.style.transform = "translate(-50%, -60%) scale(1)";
  }, 1200);

  setTimeout(() => anim.remove(), 1800);
}


function render() {
  const stamps = loadStamps();
  const tbody = document.getElementById("sheet");
  tbody.innerHTML = "";

  // åˆè¨ˆè¡¨ç¤º
  const count = { "ç èœ": 0, "ç…Œ": 0, "ç‰çœ": 0 };
  stamps.forEach(s => count[s.kid]++);
  const total = stamps.length;
  document.getElementById("totals").textContent =
    `åˆè¨ˆ ${total}å€‹ ï¼ ç èœ ${count["ç èœ"]} ãƒ» ç…Œ ${count["ç…Œ"]} ãƒ» ç‰çœ ${count["ç‰çœ"]}`;

  renderRewards(total);

  const totalRows = Math.ceil(MAX / COLS);

  for (let r = 0; r < totalRows; r++) {
    const tr = document.createElement("tr");

    for (let c = 0; c < COLS; c++) {
      const idx = r * COLS + c;
      const td = document.createElement("td");
      if (idx < stamps.length) {
        const s = stamps[idx];
        td.textContent = STAMP[s.kid] || "â­";
        td.title = `${idx + 1}å€‹ç›®ï¼š${s.date} ${s.kid}`;
      }
      tr.appendChild(td);
    }

    const num = document.createElement("td");
    num.className = "row-num";
    num.textContent = (r + 1) * COLS;
    tr.appendChild(num);

    tbody.appendChild(tr);
  }
}

function removeOne() {
  const stamps = loadStamps();
  if (stamps.length === 0) return;
  stamps.pop();
  saveStamps(stamps);
  render();
}

function removeAll() {
  if (!confirm("ã™ã¹ã¦ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
  localStorage.removeItem("stamps1000");
  render();
}

// åˆæœŸåŒ–
document.getElementById("date").value = today();
render();
</script>

</body>
</html>
