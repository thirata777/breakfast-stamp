<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ã‚ã•ã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</title>
<style>
  body { font-family: system-ui; padding: 20px; }
  h1 { text-align: center; }
  .controls { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-bottom: 16px; }
  select, input, button { font-size: 14px; padding: 6px 10px; }
  .summary { text-align: center; margin: 12px 0; font-weight: bold; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; text-align: center; padding: 6px; }
  th { background: #f5f5f5; }
</style>
</head>
<body>

<h1>ğŸ æœã”ã¯ã‚“ã‚¹ã‚¿ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰</h1>
<p style="text-align:center">çµ‚äº†ç›®æ¨™ï¼š<strong>7:30</strong></p>

<div class="controls">
  <label>
    æ—¥ã«ã¡ï¼š
    <input type="date" id="date">
  </label>
  <label>
    ãªã¾ãˆï¼š
    <select id="kid"></select>
  </label>
  <button onclick="addStamp()">ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æŠ¼ã™</button>
</div>

<div class="summary" id="summary"></div>

<table>
  <thead>
    <tr>
      <th>è¡Œ</th>
      <th>â‘ </th>
      <th>â‘¡</th>
      <th>â‘¢</th>
      <th>â‘£</th>
      <th>â‘¤</th>
    </tr>
  </thead>
  <tbody id="sheet"></tbody>
</table>

<script>
const limitTime = "07:30";
const kids = ["ç èœ", "ç…Œ", "ç‰çœ"];
const COLS = 5;
const MAX_ROWS = 200;

function today() {
  return new Date().toISOString().slice(0,10);
}

function loadStamps() {
  return JSON.parse(localStorage.getItem("stamps") || "[]");
}

function saveStamps(data) {
  localStorage.setItem("stamps", JSON.stringify(data));
}

function addStamp() {
  const date = document.getElementById("date").value;
  const kid = document.getElementById("kid").value;
  if (!date || !kid) {
    alert("æ—¥ã«ã¡ã¨ãªã¾ãˆã‚’é¸ã‚“ã§ã­");
    return;
  }

  const now = new Date().toTimeString().slice(0,5);
  if (date === today() && now > limitTime) {
    alert("æ™‚é–“ã‚ªãƒ¼ãƒãƒ¼â€¦");
    return;
  }

  const stamps = loadStamps();
  stamps.push({ date, kid });
  saveStamps(stamps);
  render();
}

function render() {
  const stamps = loadStamps();

  // ä»¶æ•°é›†è¨ˆ
  const counts = {};
  kids.forEach(k => counts[k] = 0);
  stamps.forEach(s => counts[s.kid]++);

  document.getElementById("summary").textContent =
    kids.map(k => `${k}ï¼š${counts[k]}å€‹`).join(" ï¼ ");

  const tbody = document.getElementById("sheet");
  tbody.innerHTML = "";

  for (let r = 0; r < MAX_ROWS; r++) {
    const tr = document.createElement("tr");
    let cells = `<td>${r + 1}</td>`;

    for (let c = 0; c < COLS; c++) {
      const idx = r * COLS + c;
      if (idx < stamps.length) {
        const s = stamps[idx];
        cells += `<td title="${s.date} ${s.kid}">â­</td>`;
      } else {
        cells += `<td></td>`;
      }
    }
    tr.innerHTML = cells;
    tbody.appendChild(tr);
  }
}

// åˆæœŸåŒ–
const dateInput = document.getElementById("date");
dateInput.value = today();

const kidSelect = document.getElementById("kid");nkids = kids;
kids.forEach(k => {
  const opt = document.createElement("option");
  opt.value = k;
  opt.textContent = k;
  kidSelect.appendChild(opt);
});

render();
</script>

</body>
</html>
